// Quiz state variables
let currentQuestion = 1;
let totalQuestions = 5;
let score = 0;
let attempted = 0;
let correctAnswers = 0;
let incorrectAnswers = 0;
let selectedOption = null;
let answerChecked = false;

// DOM elements
const currentQuestionEl = document.getElementById('current-question');
const totalQuestionsEl = document.getElementById('total-questions');
const scoreEl = document.getElementById('score');
const attemptedEl = document.getElementById('attempted');
const correctEl = document.getElementById('correct');
const incorrectEl = document.getElementById('incorrect');
const checkBtn = document.getElementById('checkBtn');
const nextBtn = document.getElementById('nextBtn');
const resetBtn = document.getElementById('resetBtn');

// Initialize the page
function init() {
    totalQuestionsEl.textContent = totalQuestions;
    updateStats();
    setupEventListeners();
    showQuestion(currentQuestion);
}

// Show the specified question
function showQuestion(questionNum) {
    // Hide all questions
    for (let i = 1; i <= totalQuestions; i++) {
        document.getElementById(`question${i}`).style.display = 'none';
    }
    
    // Show the current question
    document.getElementById(`question${questionNum}`).style.display = 'block';
    currentQuestionEl.textContent = questionNum;
    
    // Reset question state
    resetQuestionState();
}

// Reset question state when moving to a new question
function resetQuestionState() {
    // Remove previous selections and results
    const options = document.querySelectorAll(`#options${currentQuestion} li`);
    options.forEach(option => {
        option.classList.remove('selected', 'correct', 'incorrect');
    });
    
    // Hide explanation
    document.getElementById(`explanation${currentQuestion}`).classList.remove('show');
    
    // Reset question-specific variables
    selectedOption = null;
    answerChecked = false;
    
    // Update button states
    checkBtn.disabled = false;
    checkBtn.innerHTML = '<i class="fas fa-check-circle"></i> Check Answer';
    nextBtn.disabled = true;
    nextBtn.innerHTML = '<i class="fas fa-arrow-right"></i> Next Question';
}

// Set up event listeners
function setupEventListeners() {
    // Option click events
    for (let i = 1; i <= totalQuestions; i++) {
        const options = document.querySelectorAll(`#options${i} li`);
        options.forEach(option => {
            option.addEventListener('click', function() {
                if (answerChecked) return;
                
                // Remove selected class from all options in this question
                options.forEach(opt => opt.classList.remove('selected'));
                
                // Add selected class to clicked option
                this.classList.add('selected');
                selectedOption = this;
                
                // Enable check button
                checkBtn.disabled = false;
            });
        });
    }
    
    // Check answer button
    checkBtn.addEventListener('click', function() {
        if (!selectedOption || answerChecked) return;
        
        answerChecked = true;
        attempted++;
        
        // Show explanation
        document.getElementById(`explanation${currentQuestion}`).classList.add('show');
        
        // Check if answer is correct
        const isCorrect = selectedOption.getAttribute('data-correct') === 'true';
        
        // Mark correct/incorrect options
        const options = document.querySelectorAll(`#options${currentQuestion} li`);
        options.forEach(option => {
            if (option.getAttribute('data-correct') === 'true') {
                option.classList.add('correct');
            }
            
            if (option === selectedOption && !isCorrect) {
                option.classList.add('incorrect');
            }
        });
        
        // Update stats
        if (isCorrect) {
            score += 10;
            correctAnswers++;
        } else {
            incorrectAnswers++;
        }
        
        updateStats();
        
        // Update button states
        checkBtn.disabled = true;
        checkBtn.innerHTML = isCorrect ? 
            '<i class="fas fa-check"></i> Correct!' : 
            '<i class="fas fa-times"></i> Incorrect!';
        
        nextBtn.disabled = false;
    });
    
    // Next question button
    nextBtn.addEventListener('click', function() {
        if (currentQuestion < totalQuestions) {
            currentQuestion++;
            showQuestion(currentQuestion);
        } else {
            // Quiz completed
            alert(`Quiz completed! Your final score is ${score}. Well done!`);
            // Reset to first question
            currentQuestion = 1;
            showQuestion(currentQuestion);
        }
    });
    
    // Reset button
    resetBtn.addEventListener('click', function() {
        if (confirm("Are you sure you want to reset the quiz? All progress will be lost.")) {
            // Reset all stats
            score = 0;
            attempted = 0;
            correctAnswers = 0;
            incorrectAnswers = 0;
            currentQuestion = 1;
            
            updateStats();
            showQuestion(currentQuestion);
        }
    });
}

// Update the stats display
function updateStats() {
    scoreEl.textContent = score;
    attemptedEl.textContent = attempted;
    correctEl.textContent = correctAnswers;
    incorrectEl.textContent = incorrectAnswers;
}

// Initialize the quiz when page loads
document.addEventListener('DOMContentLoaded', init);